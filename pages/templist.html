<!DOCTYPE html>
<html>

<head>
    <!-- 页面meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>智能停车场系统</title>
    <meta name="description" content="AdminLTE2定制版">
    <meta name="keywords" content="AdminLTE2定制版">
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
    	
    <link rel="stylesheet" href="../plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../plugins/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="../plugins/iCheck/square/blue.css">
    <link rel="stylesheet" href="../plugins/morris/morris.css">
    <link rel="stylesheet" href="../plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="../plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" href="../plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="../plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="../plugins/treeTable/jquery.treetable.css">
    <link rel="stylesheet" href="../plugins/treeTable/jquery.treetable.theme.default.css">
    <link rel="stylesheet" href="../plugins/select2/select2.css">
    <link rel="stylesheet" href="../plugins/colorpicker/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="../plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" href="../plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="../plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../plugins/ionslider/ion.rangeSlider.css">
    <link rel="stylesheet" href="../plugins/ionslider/ion.rangeSlider.skinNice.css">
    <link rel="stylesheet" href="../plugins/bootstrap-slider/slider.css">
    <link rel="stylesheet" href="../plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css">
</head>

<body class="hold-transition skin-purple sidebar-mini">

    <div class="wrapper" id="app">

        <!-- 页面头部 -->
        <header class="main-header">
            <!-- Logo -->
            <a href="all-admin-index.html" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>数据</b></span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>数据</b>后台管理</span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            	<span class="sr-only">Toggle navigation</span>
        		</a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav"> 
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <img src="../img/user2-160x160.jpg" class="user-image" alt="User Image">
                        <span class="hidden-xs">张猿猿</span>
                    </a>
                            
                        </li>

                    </ul>
                </div>
            </nav>
        </header>
        <!-- 页面头部 /-->

        <!-- 导航侧栏 -->
        <!-- 导航侧栏 -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- Sidebar user panel -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="../img/user2-160x160.jpg" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <p>张猿猿</p>
                        <a href="#"><i class="fa fa-circle text-success"></i> 在线</a>
                    </div>
                </div>
                
                <ul class="sidebar-menu">
                    <li class="header">菜单</li>

                    <li id="admin-index">
                    	<a href="index.html"><i class="fa fa-dashboard"></i> <span>首页</span></a></li>

                    <!-- 菜单 -->



                    <li class="treeview">
                    <a href="#">
	                    <i class="fa fa-folder"></i> <span>系统信息管理</span>
	                    <span class="pull-right-container">
	                        <i class="fa fa-angle-left pull-right"></i>
	                    </span>
                	</a>
                        <ul class="treeview-menu">

                            <li id="rolelist">
                                <a href="rolelist.html">
                            <i class="fa fa-circle-o"></i> 管理角色信息
                        </a>
                            </li>

                            <li id="userlist">
                                <a href="userlist.html">
                            <i class="fa fa-circle-o"></i> 管理用户信息
                        </a>
                            </li>

                        </ul>
                    </li>

                    <li class="treeview">
                        <a href="#">
                    <i class="fa fa-laptop"></i> <span>车位信息管理</span>
                    <span class="pull-right-container">
                        <i class="fa fa-angle-left pull-right"></i>
                    </span>
                </a>
                        <ul class="treeview-menu">

                            <li id="seatlist">
                                <a href="seatlist.html">
                            <i class="fa fa-circle-o"></i> 管理车位信息
                        </a>
                            </li>

                        </ul>
                    </li>



                    <li class="treeview">
                        <a href="#">
                    <i class="fa fa-edit"></i> <span>IC卡信息管理</span>
                    <span class="pull-right-container">
                        <i class="fa fa-angle-left pull-right"></i>
                    </span>
                </a>
                        <ul class="treeview-menu">
                            <li id="cardlist">
                                <a href="cardlist.html">
                            <i class="fa fa-circle-o"></i> 管理IC卡类型
                        </a>
                            </li>

                            
                        </ul>
                    </li>


                    <li class="treeview">
                        <a href="#">
                    <i class="fa fa-table"></i> <span>固定车主停车管理</span>
                    <span class="pull-right-container">
                        <i class="fa fa-angle-left pull-right"></i>
                    </span>
                </a>
                        <ul class="treeview-menu">

                           <li id="fixedlist">
                                <a href="fixedlist.html">
                            <i class="fa fa-circle-o"></i> 固定车主信息
                        </a>
                            </li>

                        </ul>
                    </li>



                    <li class="treeview">
                        <a href="#">
                    <i class="fa fa-cube"></i> <span>临时车辆停车管理</span>
                    <span class="pull-right-container">
                        <i class="fa fa-angle-left pull-right"></i>
                    </span>
                </a>
                        <ul class="treeview-menu">

                            <li id="templist">
                                <a href="templist.html">
                            <i class="fa fa-circle-o"></i> 临时车主信息
                        </a>
                            </li>              
                        </ul>
                    </li>



                    <li class="treeview">
                        <a href="#">
                    <i class="fa fa-book"></i> <span>系统功能操作</span>
                    <span class="pull-right-container">
                        <i class="fa fa-angle-left pull-right"></i>
                    </span>
                </a>
                        <ul class="treeview-menu">

                            <li id="travellog-manage">
                                <a href="#" data-toggle="modal" data-target="#updatePassworld" @click="getCurrentUser">
                            <i class="fa fa-circle-o"></i> 修改密码
                        </a>
                            </li>


                            <li id="travellog-setting">
                                <a onclick="logout()">
                            <i class="fa fa-circle-o"></i> 退出系统
                        </a>
                            </li>

                        </ul>
                    </li>

                    <!-- 菜单 /-->
                </ul>
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- 导航侧栏 /-->

        <!-- 内容区域 -->
        <div class="content-wrapper">

            <!-- 内容头部 -->
            <section class="content-header">
                <h1>临时车辆管理<small>首页</small></h1>
                <ol class="breadcrumb">
                    <li><a href="all-admin-index.html"><i class="fa fa-dashboard"></i> 首页</a></li>
                </ol>
            </section>
            <!-- 内容头部 /-->

            <!-- 正文区域 -->
            <section class="content" id="content">
<!--修改密码模拟框-->
                            <div class="modal fade" id="updatePassworld" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
												&times;
											</button>
											<h4 class="modal-title" id="myModalLabel">
												修改密码
											</h4>
										</div>
										<div class="modal-body">
											<form action="#" method="get">								                
								                <div class="form-group has-feedback">
								                   <input type="text" disabled class="form-control" placeholder="用户名" v-model="user.userName">
								                </div>
								                <div class="form-group has-feedback">
								                    <input type="text" class="form-control" placeholder="旧密码" v-model="user.oldPassword">
								                </div>
								                <div class="form-group has-feedback">
								                    <input type="text" class="form-control" placeholder="新密码" v-model="user.newPassword">
								                </div>
								                 <div class="form-group has-feedback">
								                    <input type="text" class="form-control" placeholder="重复密码" v-model="user.repPassword">
								                </div>
								            </form>
										</div>
										<div class="modal-footer" align="center">
											<button type="button" class="btn btn-default" data-dismiss="modal">关闭
											</button>
											<button type="button" class="btn btn-primary" @click="updatePassword">
												提交更改
											</button>
										</div>
									</div>
								</div>
							</div>
                <!-- .box-body -->
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <h3 class="box-title">列表</h3>
                    </div>

                    <div class="box-body">

                        <!-- 数据表格 -->
                        <div class="table-box">

                            <!--工具栏-->
                            <div class="pull-left">
                                <div class="form-group form-inline">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-default" title="新建" data-toggle="modal" data-target="#addTemp"><i class="fa fa-file-o"></i> 新建</button>
                                        <button type="button" class="btn btn-default" title="刷新" @click="flush"><i class="fa fa-refresh"></i> 刷新</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!--新增模拟框-->
                            <div class="modal fade" id="addTemp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
												&times;
											</button>
											<h4 class="modal-title" id="myModalLabel">
												新增临时车辆
											</h4>
										</div>
										<div class="modal-body">
											<form action="#" method="get">	
								                <div class="form-group has-feedback">
								                    <input type="text" class="form-control" placeholder="车牌号码" v-model="temp.carNum">
								                </div>								                
								            </form>
										</div>
										<div class="modal-footer" align="center">
											<button type="button" class="btn btn-default" data-dismiss="modal">关闭
											</button>
											<button type="button" class="btn btn-primary" @click="addTemp">
												提交更改
											</button>
										</div>
									</div>
								</div>
							</div>
							
                            <div class="box-tools pull-right">
                                <div class="has-feedback">
                                    <input type="text" class="form-control input-sm" placeholder="搜索" v-model="keyWorld">
                                    <span class="glyphicon glyphicon-search form-control-feedback"></span>
                                </div>
                            </div>
                            <!--工具栏/-->

                            <!--数据列表-->
                            <table id="dataList" class="table table-bordered table-striped table-hover dataTable">
                                <thead>
                                    <tr>                                     
                                        <th class="col-lg-2">零时编号</th>
                                        <th class="col-lg-2">零时IC卡号</th>
                                        <th class="col-lg-1">车牌号码</th>
                                        <th class="col-lg-2">入场时间</th>
                                        <th class="col-lg-2">出场时间</th>
                                        <th class="col-lg-1">停车费用</th>
                                        <th class="col-lg-1">是否离场</th>
                                        <th class="col-lg-1">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in tempList">
                                        <td v-html="item.tempId"></td>
                                        <td v-html="item.cardId"></td>
                                        <td v-html="item.carNum"></td>
                                        <td v-html="item.entryTime"></td>
                                        <td v-html="item.outTime"></td>
                                        <td v-html="item.tempMoney"></td>
                                        <td v-html="item.state"></td>
                                        <td class="text-center">
                                            <button type="button" class="btn bg-olive btn-xs" @click="calculateTempMoney(item.tempId,item.state)">结算</button>
                                            <button type="button" class="btn bg-olive btn-xs" @click="deleteTemp(item.tempId)">删除</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!--数据列表/-->
                        </div>
                        <!-- 数据表格 /-->
                    </div>
                    <div class="box-footer">
                        <div class="pull-left">
                            <div class="form-group form-inline">
                                	总共<label v-html="pages"></label>页，共<label v-html="total"></label>条数据。 每页
		                        <select class="form-control" v-model="pageSize">
		                            <option>1</option>
		                            <option>2</option>
		                            <option>3</option>
		                            <option>4</option>
		                            <option>5</option>
		                        </select> 条
                            </div>
                        </div>
                        <div class="box-tools pull-right">
                            <ul class="pagination">
                                <li @click="indexPage"> 
                                    <a href="#" aria-label="Previous">首页</a>
                                </li>
                                <li @click="prePage"><a href="#">上一页</a></li>
                                <li v-for="(item,index) in pages" @click="getPageNum(index+1)"><a href="#" v-html="index+1"></a></li>
                                <li @click="nextPage"><a href="#">下一页</a></li>
                                <li @click="lastPage">
                                    <a href="#" aria-label="Next">尾页</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
            <!-- 正文区域 /-->
        </div>
        <!-- 内容区域 /-->
        <!-- 底部导航 -->
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0.0
            </div>
            <strong>Author 17436212-胡潇 <a href="http://www.huhst.edu.cn/">湖南人文科技学院</a>.
        </footer>
        <!-- 底部导航 /-->
    </div>


    <script src="../plugins/jQuery/jquery-2.2.3.min.js"></script>
    <script src="../plugins/jQueryUI/jquery-ui.min.js"></script>
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../plugins/raphael/raphael-min.js"></script>
    <script src="../plugins/morris/morris.min.js"></script>
    <script src="../plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="../plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="../plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="../plugins/knob/jquery.knob.js"></script>
    <script src="../plugins/daterangepicker/moment.min.js"></script>
    <script src="../plugins/daterangepicker/daterangepicker.js"></script>
    <script src="../plugins/daterangepicker/daterangepicker.zh-CN.js"></script>
    <script src="../plugins/datepicker/bootstrap-datepicker.js"></script>
    <script src="../plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
    <script src="../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <script src="../plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="../plugins/fastclick/fastclick.js"></script>
    <script src="../plugins/iCheck/icheck.min.js"></script>
    <script src="../plugins/adminLTE/js/app.min.js"></script>
    <script src="../plugins/treeTable/jquery.treetable.js"></script>
    <script src="../plugins/select2/select2.full.min.js"></script>
    <script src="../plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
    <script src="../plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.zh-CN.js"></script>
    <script src="../plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
    <script src="../plugins/bootstrap-markdown/locale/bootstrap-markdown.zh.js"></script>
    <script src="../plugins/bootstrap-markdown/js/markdown.js"></script>
    <script src="../plugins/bootstrap-markdown/js/to-markdown.js"></script>
    <script src="../plugins/ckeditor/ckeditor.js"></script>
    <script src="../plugins/input-mask/jquery.inputmask.js"></script>
    <script src="../plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
    <script src="../plugins/input-mask/jquery.inputmask.extensions.js"></script>
    <script src="../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../plugins/datatables/dataTables.bootstrap.min.js"></script>
    <script src="../plugins/chartjs/Chart.min.js"></script>
    <script src="../plugins/flot/jquery.flot.min.js"></script>
    <script src="../plugins/flot/jquery.flot.resize.min.js"></script>
    <script src="../plugins/flot/jquery.flot.pie.min.js"></script>
    <script src="../plugins/flot/jquery.flot.categories.min.js"></script>
    <script src="../plugins/ionslider/ion.rangeSlider.min.js"></script>
    <script src="../plugins/bootstrap-slider/bootstrap-slider.js"></script>
    <script src="../plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
    <script src="../plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="../plugins/vue/vuejs-2.5.16.js"></script>
    <script src="../plugins/axios/axios-0.18.0.js"></script>
    <script src="../plugins/config/config.js"></script>
    <script>
    	new Vue({
    		el:"#app",
    		data:{
    			keyWorld:"",
    			pages:0,
    			total:0,
    			pageNum:1,
    			pageSize:5,
    			tempList:[],
    			temp:{
    				tempId:"",
    				carNum:"",
    				state:""
    			},
    			user:{
    				username:null,
    				oldPassword:null,
    				newPassword:null,
    				repPassword:null
    			}
    		},
    		created:function(){
    			this.getTempPage(this.pageNum,this.pageSize,this.keyworld);
    		},
    		methods:{
    			getCurrentUser:function(){
    				let _this = this;
    				axios.get(baseurl+"/user/getCurrentUser").then(resp=>{
	    					if(resp.data.status){
	    						_this.user.userName=resp.data.info;
	    					}
	    				});
    			},
    			updatePassword:function(){
    				let _this = this;
    				if(this.user.newPassword==this.user.repPassword){
	    				axios.post(baseurl+"/user/updatePassword",_this.user).then(resp=>{
	    					if(resp.data.status){
	    						alert(resp.data.message+"请重新登陆");
	    						logout();
	    						window.location.href="login.html";
	    					}
	    				});
    				}else{
    					alert("输入密码不一致");
    				}
    			},
    			flush:function(){
    				location.reload();
    			},
    			getTempPage:function(){
    				let _this = this;
    				axios.post(baseurl+"/temp/getTempPage",{
    					pageNum:_this.pageNum,
	    				pageSize:_this.pageSize,
	    				keyWorld:_this.keyWorld
    				}).then(resp=>{
    					_this.tempList = resp.data.info.list;
    					for(i in _this.tempList){
    						if(_this.tempList[i].state==1){
    							_this.tempList[i].state="以离场";
    						}else{
    							_this.tempList[i].state="未离场";
    						}
    					}
    					_this.pages = resp.data.info.pages;
    					_this.total = resp.data.info.total;
    					_this.pageNum = resp.data.info.pageNum;
    					_this.pageSize = resp.data.info.pageSize;
    				});
    				
    			},
    			addTemp:function(){
    				let _this = this;
    				axios.post(baseurl+"/temp/addTemp",_this.temp).then(resp=>{
    					if(resp.data.status == 1){
    						alert(resp.data.message);
    						_this.flush();
    					}else{
    						alert(resp.data.message);
    						_this.flush();
    					}
    				});
    			},
    			deleteTemp:function(tempId){
    				let _this = this;
    				this.temp.tempId=tempId;
    				let check = confirm("请确认删除");
    				if(check == true){
	    				axios.post(baseurl+"/temp/deleteTemp",_this.temp).then(resp=>{
	    					if(resp.data.status == 1){
	    						alert(resp.data.message);
	    						_this.getTempPage(this.pageNum,this.pageSize,this.keyworld);
	    					}else{
	    						alert(resp.data.message);
	    						_this.getTempPage(this.pageNum,this.pageSize,this.keyworld);
	    					}
	    				});
    				}
    			},
    			calculateTempMoney:function(tempId,state){
    				let check = confirm("请确认结算");
    				let _this = this;
    				this.temp.tempId=tempId;
    				if(state == '以离场'){
    					state = 1;
    				}else{
    					state = 0;
    				}
    				this.temp.state = state;
    				for(i in _this.tempList){
    						if(_this.tempList[i].state=="以离场"){
    							_this.tempList[i].state=1;
    						}else{
    							_this.tempList[i].state=0;
    						}
    					}
    				if(check==true){
    					if(this.temp.state == 1){
    						alert("该车辆已离场，不用重复结算");
    						for(i in _this.tempList){
	    						if(_this.tempList[i].state==1){
	    							_this.tempList[i].state="以离场";
	    						}else{
	    							_this.tempList[i].state="未离场";
	    						}
    						}
    						return;
    					}
    					axios.post(baseurl+"/temp/calculateTempMoney",_this.temp).then(resp=>{
    						if(resp.data.status == 1){
	    						alert(resp.data.message);
	    						_this.flush();
	    					}else{
	    						alert(resp.data.message);
	    						_this.flush();
	    					}
    					});
    				}
    			},
    			getPageNum:function(pageNum){
    				this.pageNum=pageNum;
    			},
    			nextPage:function(){
    				if(this.pageNum != this.pages){
    					this.pageNum = this.pageNum+1;
    				}else{
    					alert("以到最后面");
    				}
    				
    			},
    			prePage:function(){
    				if(this.pageNum!=1){
    					this.pageNum = this.pageNum-1;
    				}else{
    					alert("以到最前面");
    				}
    				
    			},
    			indexPage:function(){
    				this.pageNum = 1;
    			},
    			lastPage:function(){
    				this.pageNum = this.pages;
    			}
    		},
    		
    		watch:{
    			pageSize(val){
    				this.getTempPage(this.pageNum,val,this.keyWorld);
    			},
    			pageNum(val){
    				this.getTempPage(val,this.pageSize,this.keyWorld);
    			},
    			keyWorld(val){
    				this.getTempPage(this.pageNum,this.pageSize,val);
    			}
    		}
    	});
    	
         // 全选操作 
        $("#selall").click(function() {
            var clicks = $(this).is(':checked');
            if (!clicks) {
                $("#dataList td input[type='checkbox']").iCheck("uncheck");
            } else {
                $("#dataList td input[type='checkbox']").iCheck("check");
            }
            $(this).data("clicks", !clicks);
        });

        // 设置激活菜单
        function setSidebarActive(tagUri) {
            var liObj = $("#" + tagUri);
            if (liObj.length > 0) {
                liObj.parent().parent().addClass("active");
                liObj.addClass("active");
            }
        }

        setSidebarActive("templist");
    </script>
</body>

</html>
<!---->